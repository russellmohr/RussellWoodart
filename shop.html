<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shop | Russell's Woodart</title>
  <link rel="stylesheet" href="/style.css"/>
</head>
<body>
  <header class="site-header">
    <div class="header-left">
      <a href="/index.html"><img src="/Images/Logo.png" alt="Russell's Woodart logo" class="header-logo"/></a>
      <div class="title-block">
        <h1 class="site-title">Russell's Woodart</h1>
        <p class="tagline">Inspired by nature, shaped by hand</p>
      </div>
    </div>
    <nav class="nav">
      <a href="/index.html">Home</a>
      <a href="/gallery.html">Gallery</a>
      <a href="/shop.html">Shop</a>
      <a href="/contact.html">Contact</a>
    </nav>
  </header>

  <main class="shop">
    <h2>Shop</h2>
    <p class="sub">Available pieces ready to ship. One-of-a-kind works.</p>

    <div class="products" id="productGrid">
      <!-- Product: Golden Manzanita Hollow Form -->
      <div class="product-card" data-id="GoldenManHF">
        <img src="/Images/Gallery/GoldenManHF/GoldenManHF-1.jpg" alt="Manzanita Hollow Form — Golden Epoxy"/>
        <div class="product-body">
          <h3 class="product-title">Manzanita Hollow Form — Golden Epoxy</h3>
          <p class="product-sub">Manzanita burl + golden epoxy</p>
          <div class="price" data-price="450">USD $450</div>
          <div class="badges">
            <!-- Example badges:
            <span class="badge reserved">Reserved</span>
            <span class="badge sold">Sold</span>
            -->
          </div>
          <button class="btn-add" data-add="GoldenManHF">Add to Cart</button>
          <a class="btn" style="display:inline-block;margin-top:8px" href="/Pieces/GoldenManHF.html">View details</a>
        </div>
      </div>

      <!-- Example (copy to add more products)
      <div class="product-card" data-id="CherryGoblet01">
        <img src="/Images/Gallery/CherryGoblet01/CherryGoblet01-1.jpg" alt="Cherry Burl Goblet"/>
        <div class="product-body">
          <h3 class="product-title">Cherry Burl Goblet</h3>
          <p class="product-sub">Cherry burl, oil-wax finish</p>
          <div class="price" data-price="220">USD $220</div>
          <div class="badges">
            <span class="badge reserved">Reserved</span>
          </div>
          <button class="btn-add" data-add="CherryGoblet01" disabled>Add to Cart</button>
          <a class="btn" style="display:inline-block;margin-top:8px" href="/Pieces/CherryGoblet01.html">View details</a>
        </div>
      </div>
      -->
    </div>

    <div class="custom-order">
      <strong>Looking for something custom?</strong>
      <p>Commission a piece made just for you. Tell me the wood species, size, and style you love.</p>
      <a class="btn" href="/contact.html">Start a custom order</a>
    </div>
  </main>

  <!-- Floating Cart Button -->
  <button class="cart-fab" id="cartFab">Cart (<span id="cartCount">0</span>)</button>

  <!-- Cart Drawer -->
  <aside class="cart-drawer" id="cartDrawer" aria-hidden="true">
    <div class="cart-header">
      <h3 style="margin:0">Your Cart</h3>
      <button id="closeCart" class="btn" style="padding:6px 10px">Close</button>
    </div>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-total">
      <span>Total</span>
      <span id="cartTotal">$0.00</span>
    </div>
    <div class="paypal-wrap">
      <!-- PayPal Buttons mount here -->
      <div id="paypal-button-container"></div>
      <small style="color:#777;display:block;margin-top:6px;">PayPal checkout — USD</small>
    </div>
  </aside>

  <!-- PayPal SDK (Abaj7oQMyPwxm0yMmObDexczAI6l4l_fXu_jKVy7Ds9-utBc5IjT9oau34G0kuwaZ_5e3Or76PwcflsF) -->
  <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD" data-sdk-integration-source="button-factory"></script>

  <script>
  // ---------- Simple product catalog ----------
  const PRODUCTS = {
    "GoldenManHF": {
      id: "GoldenManHF",
      name: "Manzanita Hollow Form — Golden Epoxy",
      price: 45000, // cents
      img: "/Images/Gallery/GoldenManHF/GoldenManHF-1.jpg"
    }
    // Add more products here...
  };

  // ---------- Cart state (localStorage) ----------
  const CART_KEY = "rw_cart_v1";
  const $ = (sel) => document.querySelector(sel);

  function loadCart() {
    try { return JSON.parse(localStorage.getItem(CART_KEY)) || {}; }
    catch { return {}; }
  }
  function saveCart(cart) {
    localStorage.setItem(CART_KEY, JSON.stringify(cart));
    renderCart();
  }
  function addToCart(id, qty=1) {
    const cart = loadCart();
    cart[id] = (cart[id] || 0) + qty;
    saveCart(cart);
    openCart();
  }
  function setQty(id, qty) {
    const cart = loadCart();
    if (qty <= 0) { delete cart[id]; }
    else { cart[id] = qty; }
    saveCart(cart);
  }
  function cartCount() {
    const cart = loadCart();
    return Object.values(cart).reduce((a,b)=>a+b, 0);
  }
  function cartLines() {
    const cart = loadCart();
    return Object.entries(cart).map(([id, qty]) => {
      const p = PRODUCTS[id];
      return { id, qty, name: p.name, img: p.img, price: p.price, lineTotal: p.price * qty };
    });
  }
  function cartTotalCents() {
    return cartLines().reduce((sum,l)=>sum + l.lineTotal, 0);
  }
  function fmtUSD(cents) {
    return new Intl.NumberFormat('en-US',{ style:'currency', currency:'USD' }).format(cents/100);
  }

  // ---------- UI: Cart rendering ----------
  function renderCart() {
    const itemsDiv = $("#cartItems");
    const totalSpan = $("#cartTotal");
    const countSpan = $("#cartCount");
    const lines = cartLines();

    countSpan.textContent = cartCount();
    if (!lines.length) {
      itemsDiv.innerHTML = "<p>Your cart is empty.</p>";
      totalSpan.textContent = "$0.00";
      return;
    }

    itemsDiv.innerHTML = lines.map(l => `
      <div class="cart-row">
        <img src="${l.img}" alt="${l.name}"/>
        <h4>${l.name}</h4>
        <div class="qty">
          <button aria-label="Decrease" onclick="setQty('${l.id}', ${l.qty-1})">–</button>
          <span>${l.qty}</span>
          <button aria-label="Increase" onclick="setQty('${l.id}', ${l.qty+1})">+</button>
        </div>
        <div style="font-weight:800">${fmtUSD(l.lineTotal)}</div>
      </div>
    `).join('');
    totalSpan.textContent = fmtUSD(cartTotalCents());
  }

  // ---------- Drawer controls ----------
  const drawer = $("#cartDrawer");
  function openCart(){ drawer.classList.add("open"); drawer.setAttribute("aria-hidden","false"); renderCart(); }
  function closeCart(){ drawer.classList.remove("open"); drawer.setAttribute("aria-hidden","true"); }

  $("#cartFab").addEventListener("click", openCart);
  $("#closeCart").addEventListener("click", closeCart);

  // ---------- Product buttons ----------
  document.querySelectorAll("[data-add]").forEach(btn=>{
    btn.addEventListener("click", () => addToCart(btn.dataset.add, 1));
  });

  // If arriving with ?add=ProductId in URL, auto-add then open cart
  const urlParams = new URLSearchParams(location.search);
  const addParam = urlParams.get("add");
  if (addParam && PRODUCTS[addParam]) addToCart(addParam, 1);

  // ---------- PayPal Buttons ----------
  function paypalCreateOrder(data, actions) {
    const lines = cartLines();
    if (!lines.length) return;

    // Build items for PayPal (USD)
    const value = (cartTotalCents()/100).toFixed(2);
    return actions.order.create({
      purchase_units: [{
        amount: {
          currency_code: "USD",
          value,
          breakdown: {
            item_total: { currency_code: "USD", value }
          }
        },
        items: lines.map(l => ({
          name: l.name,
          unit_amount: { currency_code: "USD", value: (l.price/100).toFixed(2) },
          quantity: l.qty.toString()
        }))
      }]
    });
  }

  function paypalOnApprove(data, actions) {
    return actions.order.capture().then(function(details) {
      // Clear cart after successful payment
      localStorage.removeItem(CART_KEY);
      renderCart();
      alert("Thank you, " + (details.payer.name?.given_name || "collector") + "! Your order was completed.");
      closeCart();
    });
  }

  if (window.paypal) {
    paypal.Buttons({
      createOrder: paypalCreateOrder,
      onApprove: paypalOnApprove
    }).render('#paypal-button-container');
  }

  // Initial render
  renderCart();
  </script>
</body>
</html>