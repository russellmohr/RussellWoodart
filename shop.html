<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shop | Russell's Woodart</title>
  <link rel="stylesheet" href="/style.css"/>
</head>
<body>
  <header class="site-header">
    <div class="header-left">
      <a href="/index.html"><img src="/Images/Logo.png" alt="Russell's Woodart logo" class="header-logo"/></a>
      <div class="title-block">
        <h1 class="site-title">Russell's Woodart</h1>
        <p class="tagline">Inspired by nature, shaped by hand</p>
      </div>
    </div>
    <nav class="nav">
      <a href="/index.html">Home</a>
      <a href="/gallery.html">Gallery</a>
      <a href="/shop.html">Shop</a>
      <a href="/contact.html">Contact</a>
    </nav>
    <div class="header-right">
      <button id="headerCartBtn" class="cart-link">Cart (<span id="cartCount">0</span>)</button>
    </div>
  </header>

<!-- Cart Drawer (shared on all pages) -->
<aside class="cart-drawer" id="cartDrawer" aria-hidden="true">
  <div class="cart-header">
    <h3 style="margin:0">Your Cart</h3>
    <button id="closeCart" class="btn" style="padding:6px 10px">Close</button>
  </div>
  <div class="cart-items" id="cartItems"></div>
  <div class="cart-total">
    <span>Total</span>
    <span id="cartTotal">$0.00</span>
  </div>
  <div class="paypal-wrap">
    <div id="paypal-button-container"></div>
    <small style="color:#777;display:block;margin-top:6px;">PayPal checkout — USD</small>
  </div>
</aside>

  <main class="shop">
    <h2>Shop</h2>
    <p class="sub">Available pieces ready to ship. One-of-a-kind works.</p>

    <div class="products" id="productGrid">
      <!-- Product 1 -->
      <div class="product-card" data-id="GoldenManHF">
        <img src="/Images/Gallery/GoldenManHF/GoldenManHF-1.jpg" alt="Manzanita Hollow Form — Golden Epoxy"/>
        <div class="product-body">
          <h3 class="product-title">Manzanita Hollow Form — Golden Epoxy</h3>
          <p class="product-sub">Manzanita burl + golden epoxy</p>
          <div class="price" data-price="450">USD $450</div>
          <button class="btn-add" data-add="GoldenManHF" onclick="RWCart.add('GoldenManHF')">Add to Cart</button>
          <a class="btn" style="display:inline-block;margin-top:8px" href="/Pieces/GoldenManHF.html">View details</a>
        </div>
      </div>

      <!-- Product 2 -->
      <div class="product-card" data-id="SegmentBocoteBowl">
        <img src="/Images/Gallery/SegmentBocoteBowl/SegmentBocoteBowl-1.jpg" alt="Segment Bocote Bowl"/>
        <div class="product-body">
          <h3 class="product-title">Segment Bocote Bowl</h3>
          <p class="product-sub">Segmented Bocote bowl</p>
          <div class="price" data-price="320">USD $320</div>
          <button class="btn-add" data-add="GoldenManHF" onclick="RWCart.add('GoldenManHF')">Add to Cart</button>
          <a class="btn" style="display:inline-block;margin-top:8px" href="/gallery.html">View details</a>
        </div>
      </div>

      <!-- Product 3 (filename corrected) -->
      <div class="product-card" data-id="CherryBurlGoblet">
        <img src="/Images/Gallery/CherryBurlGoblet/CherryBurlGoblet-1.jpg" alt="Cherry Burl Goblet"/>
        <div class="product-body">
          <h3 class="product-title">Cherry Burl Goblet</h3>
          <p class="product-sub">Cherry burl, oil-wax finish</p>
          <div class="price" data-price="260">USD $260</div>
          <button class="btn-add" data-add="GoldenManHF" onclick="RWCart.add('GoldenManHF')">Add to Cart</button>
          <a class="btn" style="display:inline-block;margin-top:8px" href="/gallery.html">View details</a>
        </div>
      </div>
    </div>

    <div class="custom-order">
      <strong>Looking for something custom?</strong>
      <p>Commission a piece made just for you. Tell me the wood species, size, and style you love.</p>
      <a class="btn" href="/contact.html">Start a custom order</a>
    </div>
  </main>

  <!-- Cart Drawer (no quantity controls) -->
  <aside class="cart-drawer" id="cartDrawer" aria-hidden="true">
    <div class="cart-header">
      <h3 style="margin:0">Your Cart</h3>
      <button id="closeCart" class="btn" style="padding:6px 10px">Close</button>
    </div>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-total">
      <span>Total</span>
      <span id="cartTotal">$0.00</span>
    </div>
    <div class="paypal-wrap">
      <div id="paypal-button-container"></div>
      <small style="color:#777;display:block;margin-top:6px;">PayPal checkout — USD</small>
    </div>
  </aside>

  <!-- PayPal SDK -->
  <!-- Sandbox (shows real buttons): client-id=sb. Switch to Live by replacing "sb" with your Live Client ID. -->
  <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>

  <script>
  // ---------- Product catalog ----------
  const PRODUCTS = {
    "GoldenManHF": {
      id: "GoldenManHF",
      name: "Manzanita Hollow Form — Golden Epoxy",
      price: 45000, // cents
      img: "/Images/Gallery/GoldenManHF/GoldenManHF-1.jpg"
    },
    "SegmentBocoteBowl": {
      id: "SegmentBocoteBowl",
      name: "Segment Bocote Bowl",
      price: 32000,
      img: "/Images/Gallery/SegmentBocoteBowl/SegmentBocoteBowl-1.jpg"
    },
    "CherryBurlGoblet": {
      id: "CherryBurlGoblet",
      name: "Cherry Burl Goblet",
      price: 26000,
      img: "/Images/Gallery/CherryBurlGoblet/CherryBurlGoblet-1.jpg"
    }
  };

  // ---------- Cart (one-of-a-kind: max 1 each) ----------
  const CART_KEY = "rw_cart_v1";
  const $ = (sel) => document.querySelector(sel);

  function loadCart() {
    try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; }
    catch { return []; }
  }
  function saveCart(cart) {
    localStorage.setItem(CART_KEY, JSON.stringify(cart));
    renderCart();
  }
  function addToCart(id) {
    const cart = loadCart();
    if (!cart.includes(id)) cart.push(id);    // add only if not already there
    saveCart(cart);
    disableAddedButtons();
    openCart();
  }
  function removeFromCart(id) {
    const cart = loadCart().filter(x => x !== id);
    saveCart(cart);
    disableAddedButtons();
  }
  function cartCount() { return loadCart().length; }
  function cartLines() { return loadCart().map(id => ({ ...PRODUCTS[id] })); }
  function cartTotalCents() { return cartLines().reduce((s,p)=>s+p.price, 0); }
  function fmtUSD(cents) {
    return new Intl.NumberFormat('en-US',{ style:'currency', currency:'USD' }).format(cents/100);
  }

  function renderCart() {
    const itemsDiv = $("#cartItems");
    const totalSpan = $("#cartTotal");
    const countSpan = $("#cartCount");
    const lines = cartLines();

    countSpan.textContent = cartCount();

    if (!lines.length) {
      itemsDiv.innerHTML = "<p>Your cart is empty.</p>";
      totalSpan.textContent = "$0.00";
      return;
    }

    itemsDiv.innerHTML = lines.map(l => `
      <div class="cart-row">
        <img src="${l.img}" alt="${l.name}"/>
        <h4>${l.name}</h4>
        <button class="btn" style="padding:6px 10px" onclick="removeFromCart('${l.id}')">Remove</button>
        <div style="font-weight:800;text-align:right">${fmtUSD(l.price)}</div>
      </div>
    `).join('');

    totalSpan.textContent = fmtUSD(cartTotalCents());
  }

  function disableAddedButtons() {
    const cart = loadCart();
    document.querySelectorAll("[data-add]").forEach(btn => {
      if (cart.includes(btn.dataset.add)) {
        btn.textContent = "Added";
        btn.disabled = true;
      } else {
        btn.textContent = "Add to Cart";
        btn.disabled = false;
      }
    });
  }

  // Drawer controls
  const drawer = $("#cartDrawer");
  function openCart(){ drawer.classList.add("open"); drawer.setAttribute("aria-hidden","false"); renderCart(); }
  function closeCart(){ drawer.classList.remove("open"); drawer.setAttribute("aria-hidden","true"); }
  $("#cartFab").addEventListener("click", openCart);
  $("#closeCart").addEventListener("click", closeCart);

  // Product buttons
  document.querySelectorAll("[data-add]").forEach(btn=>{
    btn.addEventListener("click", () => addToCart(btn.dataset.add));
  });

  // Auto-add via URL param (works from Gallery buttons)
  const urlParams = new URLSearchParams(location.search);
  const addParam = urlParams.get("add");
  if (addParam && PRODUCTS[addParam]) addToCart(addParam);

  // PayPal Buttons (Sandbox)
  function paypalCreateOrder(data, actions) {
    const lines = cartLines();
    if (!lines.length) return;

    const value = (cartTotalCents()/100).toFixed(2);
    return actions.order.create({
      purchase_units: [{
        amount: {
          currency_code: "USD",
          value,
          breakdown: { item_total: { currency_code: "USD", value } }
        },
        items: lines.map(l => ({
          name: l.name,
          unit_amount: { currency_code: "USD", value: (l.price/100).toFixed(2) },
          quantity: "1"
        }))
      }]
    });
  }

  function paypalOnApprove(data, actions) {
    return actions.order.capture().then(function(details) {
      localStorage.removeItem(CART_KEY);
      renderCart();
      disableAddedButtons();
      alert("Thank you, " + (details.payer.name?.given_name || "collector") + "! Your order was completed.");
      closeCart();
    });
  }

  if (window.paypal) {
    paypal.Buttons({
      createOrder: paypalCreateOrder,
      onApprove: paypalOnApprove
    }).render('#paypal-button-container');
  }

  // Initial UI state
  renderCart();
  disableAddedButtons();
  </script>
<!-- PayPal SDK (Sandbox now; replace client-id when you go Live) -->
<script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>
<!-- Shared cart logic -->
<script src="/cart.js"></script>
</body>
</html>